基于机器学习的钓鱼网站数据集分析方法与实现			


第一章绪论

1.1概述

	随着科技的进步与发展，人们的生活越来越离不开网络，社交应用，电商购物，游戏娱乐，虚拟货币等等相关应用与人们的个人隐私息息相关。而现如今，越来越多的人使用支付宝，微信，虚拟货币等等来消费购物，很多人的网络帐号里都有大量的资金或者等价值的虚拟物品，于是，很多不法分子便将目光投向了网络用户的网络帐号中的资金和物品。而网络钓鱼相较于其他黑客手段，则是门槛较低，操作较为简单的一种盗取用户帐号密码的攻击方式。
	“网络钓鱼”，英文名为“Phishing”，由于现如今杀毒软件的流行和漏洞的快速修复，并且通过撞库，入侵等手段获取用户的帐号密码需要大量的时间和尝试，并且对黑客技术要求较高，所以很多网络上的攻击者便通过模仿的email和网站来伪装成正规的网站和邮件，来让访问者误以为他们进入的是正规的网站，进而输入自己的相关帐号密码等一些敏感信息，然而这些敏感信息最后都会落入攻击者之手，轻者丢失一些资金，严重的可能连帐号密码都会被攻击者修改。
	在网络高度发达的今天，网络钓鱼攻击已经成为了一个很大的隐患，由于它与其他的网络攻击行为（病毒，蠕虫，漏洞）并不太一样，它是一种社会工程学的网络攻击行为，并且主要面向那些对互联网不太熟悉或者比较粗心的用户，利用他们并不会仔细检查网站和邮件不同的心理，来达到欺骗他们来获取用户帐号密码的罪恶目的。

1.2研究的背景和意义

	现如今的网络钓鱼形势与前两年相比有了很大的不同，主要体现在两个方面。
	其一，钓鱼攻击者的攻击目标与以前相比有了很大的不同，主要是因为现如今很多用户喜欢将自己不同网站的密码设置成一样，根据2017电商生态安全联盟发布的《电子商务生态安全白皮书》[1]，不法分子前期的盗号主要通过钓鱼木马来进行，后期则是由于不法分子手上掌握了大量的已泄露的网站数据库，而很多用户使用不同帐号时设置的密码完全一样，据统计，黑色产业人员掌握了数十亿对帐号密码关系，而通过撞库和刷库盗取的帐号占所有被盗帐号的80%。不仅如此，现在大部分网站的用户身份认证方式已经从唯一的用户名密码演变成了”手机号+密码“或”邮箱+密码“，这致使用户的某一网站的帐号密码泄露后，其他的没有设置短信身份验证的网站的帐号密码就会全部泄露。
	其二，近两年，随着勒索病毒攻击事件的大量出现，部分感染用户并没有备份重要文件的习惯从而不得不支付赎金，以恢复自己被加密的文件，这也导致黑客们尝到了勒索病毒攻击的甜头。而传播勒索病毒的很高效的方法就是大范围的网络钓鱼攻击。
	最近的趋势表明，网络钓鱼攻击者的目标从根本上改变了，现在不法分子选择目标主要基于一下三点：一， 获得帐号密码，然后立刻偷取账户中的钱;二，不法分子可以里同这些帐号密码在更大范围内发动撞库攻击;三，不法分子收集被钓鱼者的信息，然后将这些信息利用到其它违法活动中，比如：身份盗窃，出卖信息。[2]
	根据国家互联网应急中心（以下简称CNCERT）发布的《2017年我国互联网网络安全态势综述》[3]，2017年，CNCERT检测发现了4.9万个仿冒我国网站的网页，相比与2016年的17.8万个，有了明显的下降，从顶级域名分布情况来看，如图一所示，“com”，“c”，“cn”占比为前三位;从仿冒类型来看，实名认证和积分兑换仿冒页面占比最多;从仿冒网站的IP地址归属来看，如图二所示，有88%位于境外，而其中我国香港的钓鱼网站IP地址占了境外钓鱼网站总数的一半 
		图一，2017年钓鱼网站所用顶级域名分布
		图二，2017年钓鱼网站IP地址归属分布
	最早的网络钓鱼攻击出现在美国部分地区，然而随着我国互联网产业的高速发展，尤其是网络支付和电商购物，越来越多的网络钓鱼攻击如雨后春笋般纷纷出现在神舟大地上。而对于普通用户，尤其是中老年用户来说，他们只能从外观上来判别这个网站是不是自己想登录的网站，而几乎所有钓鱼网站在外观上与正规网站都高度相似，所以他们很难分辨清楚自己登录的是不是钓鱼网站，再加上他们的防范意识较差，一旦他们登录了钓鱼网站，十有八九就会输入自己的敏感信息和帐号密码，从而遭受到经济损失。现如今网络钓鱼攻击已经遍布互联网的方方面面，对用户私人信息，网络支付和电商购物造成了相当大的危害，严重影响了部分人群对互联网安全的信心。

1.3研究目标

	虽然钓鱼网站的手段多种多样，但是万变不离其宗，我们依然可以从最根本的方面来检测钓鱼网站，这就为我们检测钓鱼网站提供了理论基础。传统的依靠人力检测与举报的方法在钓鱼网站数量较少的时候还是可行的，然而现如今这信息爆炸的时代，它是万万不可行的。
	现如今，机器学习已经经历了几十年的发展，有高潮也有低谷，以深度学习为代表的机器学习是目前较为接近人类大脑的人工智能方法，虽然目前机器学习仍然处于起步阶段，与人脑相比依然存在巨大的差距，然而在海量相似数据的分析处理这一方面，机器学习具有消耗速度较快，消耗人力较少，准确度较高的优势。
	因此我希望通过对这个课题的研究，通过对大量钓鱼网站数据集的分析，准确地提取出它们的特征，并采用机器学习的方法来分析这些特征以达到识别钓鱼网站的目的。

1.4本文架构

	本文一共分为六个章节
	第一章是绪论首先介绍了当前网络钓鱼的形势，然后讲述了研究的背景和意义以及目标。
	第二章是国内外研究现状的介绍，首先介绍了网络钓鱼攻击的流程，然后阐述了现阶段常见的网络钓鱼攻击技术，最后介绍了当前流行的常见的网络钓鱼检测技术。
	第三章主要介绍了基于机器学习的钓鱼网站数据集分析方法的流程，首先对比了常见钓鱼网站检测技术的优劣，然后从算法流程这个方面，依次介绍了数据预处理，特征提取，分类器训练与处理。
	第四章对比研究并实现了常见的分类器模型，分别研究并实现了K-近邻算法，决策树，Logistic回归，Adaboost 与 随机森林，然后比较了这些分类器的分类准确率。
	第五章在前一章的基础上改进了随机森林算法，然后将它与改进之前的算法进行对比。
	第六章在前五章的基础上总结了本文的研究内容，探讨了可能的算法改进之处并展望未来。

第二章国内外研究现状

2.1引言

	网络钓鱼攻击是一种利用社会工程技术来企图伪装成用户熟悉的网站以获得帐号密码和信用卡相关信息的犯罪行为，由于现代社会的信息爆炸，对于很多用户来说，如何分辨网站是否仿冒并不是一件很简单的事情。从网络钓鱼的攻击目标来看，网络钓鱼攻击可以分为两类，一类是针对银行和在线支付的用户，不法分子通过高度仿冒的网站界面来诱使用户输入相关信息以达到不可告人的秘密;另一类是针对社交网站用户，因为不法分子可以将从社交网站用户那里非法获取的数据用于身份盗窃，伪装成用户，向他的朋友亲戚发送钓鱼邮件。常言道：知己知彼，百战不殆。所以接下来，我将先介绍常见的网络钓鱼攻击技术。

2.2网络钓鱼攻击技术

	根据各自的特点，研究人员将常见的网络钓鱼攻击技术分为以下以下六类：伪装真实网站的链接，规避内容过滤器的检测，伪造正规网站，通过电话进行网络钓鱼，通过wifi免费热点来进行网络钓鱼，利用网站漏洞来进行网络钓鱼。接下来我将介绍这六类网络钓鱼攻击技术。

2.2.1伪装真实网站网址
	
	首先我必须要介绍一下目前的浏览器是如何识别url的，现在使用的浏览器不仅支持采用ASCII编码的网址，还能兼容那些对那些字符采用url编码处理的网址，而所谓的url编码的实际上就是把相应的网址转为ASCII编码形式，最后再加上分割符号“%”并且把他们转为十六进制字符。举个例子，www.amazon.cn和www.amazon%2E%63%6E实际上指向的都是亚马逊中国的主页。
	因此大部分的网络钓鱼攻击技术都是利用人们对网络内容并无太多防备之心来完成某种意义上的视觉欺骗，常见做法是通过邮箱或者短信给你发送一封邮件或者短信，里面含有似乎属于真正合法组织的网址，然而实际上，不法分子故意注册一个与正规网站域名高度相似的域名，例如www.amazan.cn或者www.amazon.example.cn再将其中的”.example”转为url编码形式，然后网页的内容与亚马逊中国高度相似甚至完全一样，如图三所示，这样对于普通的互联网用户来说，他们看到amazon可能就会认为这是正规网站而不会细思，也就不会联想到这个链接实际上指向的是一个钓鱼网站，从而致使普通用户被欺骗，遭受经济损失。另一种常见的手段是使用锚文本链接，例如接下来的锚文本名为：您的中国银行账户主页，实际上它指向的是另外的虚假的网页[4]
		图三，高度相似的亚马逊中国钓鱼网站

2.2.2规避内容过滤器的检测
	
	首先让我来介绍一下 什么是内容过滤器，由于很多钓鱼网站都包含“帐号”，“密码”等等这样的敏感词，如果浏览器检测到用户正在访问的网站并不是官方网站，或者有钓鱼网站的嫌疑，如果此时该网站中包含“帐号”，“密码”这样的敏感词，浏览器就会提示用户，让其注意一下目前访问的是不是正版网站，并且小心输入帐号密码。
	在越来越多的网站采用内容过滤器后，不法分子开始将目光转到了图片上，通过采用包含“支付宝”，“银行”，“帐号”，“密码”等等这样的关键字图片，来避免被浏览器的内容过滤器识别，如图四，图五所示。
我们可以看到，图四中是一个与PayPal网站高度相似的钓鱼网站，然而如果我们选中高亮的红色提示文字，我们就会发现其中的”PayPal account”其实是图片，这样浏览器的内容过滤器就不会识别并向用户发出警告了。[5]
	
	图四，高度相似的PayPal网站
	图五，关键词被图片所代替

2.2.3伪造正规网站

	某些时候就算用户认真检查了网址，可能也无法发现端倪。例如：一些网络钓鱼攻击者通过使用JavaScript命令，可以使得浏览器的地址栏被一张合法网址的地址栏图片盖住，或者是重新访问一个新的网页。如图六所示，该网页的地址栏实际上被工具栏图片所掩盖，这时候不法分子就可以将它们想伪装的网址放到工具栏图片中，只有当用户右键单击工具栏后，才会发现真正的地址栏，如图七所示。[6]现在，很多不法分子采用flash或者h5技术来构建网页，将自己的文字隐藏在多媒体对象等一些浏览器难以检查的对象中，以逃避反网钓技术的扫描。
	
	图六，地址栏被图片掩盖的网页

	图七，当右键单击工具栏之后，弹出地址栏

2.2.4电话网钓

	网络钓鱼不仅仅出现在网络中，现在有很多不法分子利用伪基站或一些奇淫技巧伪装成某些节目或者运营商的官方号码，然后大批量向该区域内的用户发送中奖短信，然而短信中一般包含的都是钓鱼网站的网址，一旦用户轻信了这些网站，一不小心点开链接并输入自己的敏感信息，就会遭受巨大的经济损失

2.2.5利用免费wifi热点

	随着科技的发展，网速已经越来越快，由于流量是有限的并且还是比较昂贵的，所以越来越多的用户离不开公共场所的免费wifi热点，然而有部分黑客，会在公共场所设置一个假的wifi热点，来吸引用户连接该热点。一旦用户不小心登录了黑客设置的伪wifi热点，那么轻则丢失自己个人数据和隐私文件，更严重者的手机电脑会被黑客安装间谍软件，设置后门。很多城市都有免费的公共wifi，比如武汉有些地方的免费公共wifi名为iWuhan-free，这时候，黑客就可以设置一个假的wifi热点，名字叫WuhanGongGong-free，而对那一带不熟悉的人并不知道wifi的真假，这样就会掉入黑客的陷阱

2.2.6利用网站漏洞

	近几年比较知名的漏洞就是，新加坡南洋理工大学一名博士生于2014年5月发现了OAuth和OpenID开源登录工具的“隐蔽重定向漏洞”（英文名为：Covert Redirect）[7][8]。攻击者利用该漏洞可以创建一个使用真实网站地址的弹出登录窗口，从而取代了之前的使用相似域名和界面的低级手段，从而引诱用户输入他们的个人信息，由于别的网络钓鱼方法基本上用的都是假的网站，而该漏洞利用了真的知名网站来进行钓鱼，以假乱真，让人难以分辨。只要访客访问该钓鱼网站并且登录授权，黑客就可以立刻读取该用户存储在该网站上的私密数据。
	相比与其他的网络钓鱼攻击技术，利用网站漏洞的黑客网钓行为破坏力是最大的，也是普通用户很难防备的。用户能做的只有积极更新浏览器或者使用安全软件下载补丁并修复漏洞。

2.3网络钓鱼网站检测技术
	
	虽然黑客们网络钓鱼的手段层出不穷，但是万变不离其宗，只要抓住它的核心，就不难检测出这些钓鱼网站。现如今，国内国外的机构组织也都认识到了钓鱼网站的危害，早早就成立了一些专门的组织，用以检测并封禁钓鱼网站。
	在国内，比较知名的有中国反钓鱼网站联盟（简称：”APAC”)[9]，它是于2008年成立的国内首个专门为了解决此问题而成立的民间行业协调组织，APAC旨在建立反钓鱼网站协调机制，推动反钓鱼网站综合治理体系的建设，共享反钓鱼网站的有关信息，它的成员包括了银行证券，电子商务等网络钓鱼重灾区以及域名管理注册机构，力求从域名这一根本上遏制住钓鱼网站的势头。
	在国外，比较知名的有PhishTank[10]，它是一个基于社区的反钓鱼攻击的网站，2006年10月份成立，同时也是OpenDNS的子公司，它的网站用户可以从全世界各地向该网站提交汇报钓鱼网站网址，再经其他用户投票认证，若确定它是钓鱼网站，则通过该网站的API接口共享给所有使用PhishTank服务的企业和个人。
目前有很多知名安全公司和机构都在使用PhishTank的服务来过滤钓鱼网站。
	根据检测依据的不同，按照基于URL检测，基于启发式检测和基于视觉相似检测的顺序，网络钓鱼网站检测技术主要可以分为以下几种：URL黑名单检测，机器学习判别网址，结合多种特征检测钓鱼网站，根据网站身份检测钓鱼网站，根据视觉相似度检测钓鱼网站

2.3.1URL黑名单检测技术

	当某个用户或者组织机构发现钓鱼网站之后，经确认无误后，再将该钓鱼网站的网址上传到黑名单中，最后某些公司根据这个黑名单来拦截钓鱼网站，这就是URL黑名单检测技术，这是最传统也是最原始的方法，目前主流的浏览器和知名IT公司大都将该检测技术包含在了自己的钓鱼网站检测系统中。虽然该方法的检测精度简单易实现，并且准确度高，但是由于该方法太过于依赖人工验证，并且由于数据来源有限，经常会导致无法及时更新黑名单的问题，不仅如此，很多钓鱼网站的生存周期都非常短暂，因此每次更新黑名单都需要检测黑名单中的网址是否依然存活，若否则将其从黑名单移除，并且人工识别存在着费时费力，低效成本过高的问题，不难看出，该技术最大的问题就是无法实时更新黑名单除非消耗海量人力来进行黑名单更新工作，所以该技术并不足以完全承担起检测钓鱼网站的重任。

2.3.2机器学习判别

	
 	常见的基于机器学习的钓鱼网站检测技术是基于网站的URL的，通常流程为：获得网址数据集，数据集预处理，从数据集中提取出特征向量，训练分类器模型，使用分类器分类网址。接下来我将以Garera算法[11]为例，简要阐述一下该方法：首先研究人员分析常见的钓鱼网址的URL结构特点，然后利用Logistic Regression分类器对URL进行分类，最后将常见的钓鱼网站网址分为4种类型，再结合网页外观特点，域名网址特点，网址类型等提取出18个特征，最后采用回归滤波器来训练该分类器十八个特征的系数，最后采用测试数据，来测试算法的准确率

2.3.3结合多种特征综合判别

	由于不同的钓鱼网站采用的技术手段并不相同，只根据单一特征或单一方面来判断该网站是不是钓鱼网站，并不能得到太准确的结果，所以现在常见的手段是结合待检测网站的多个方面综合判断。例如CATINA系统，该系统是Zhang[12]等研究人员设计的基于网页内容等多个方面的钓鱼网站检测系统。该系统通过分析网页中每个术语的TF-IDF值，然后以前5个最大TF-IDF值的术语作为术语组，然后用谷歌搜索该术语组，如果该网址与前n个搜索结果的网址匹配，那么这个疑似钓鱼网站的网址就是合法的了。不仅如此，研究人员还通过采用域名生存周期，引用图片，可疑链接等特征，用以确定钓鱼网站。在没有结合这些特征之前，该算法的报错率高达30%，然而当我们采用这些特征后，该算法的准确率达到了95%。

2.3.4基于网站身份检测



2.3.5根据视觉相似度检测	

2.4本章小结

